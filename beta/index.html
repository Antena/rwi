<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title></title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

<!-- Le styles -->
<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
<link href="../assets/css/custom.css" rel="stylesheet">
<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->

</head>

<body>
<div class="container-narrow">
<div class="row-fluid">
  <div class="span10">
    <h1>Overall Results</h1>
    <p>Cras vel erat lectus, eget ornare lectus. Cras vestibulum tincidunt ligula, id commodo lorem condimentum sed. Nulla vel laoreet nibh. Mauris vel scelerisque nulla. Maecenas porta, mauris quis cursus gravida, orci enim tempor orci, ut blandit tortor nibh id enim. Mauris vitae tortor nisi, eu pulvinar sem. Nullam lacinia tellus id purus gravida a mattis orci ornare. Donec scelerisque nisi sit amet enim laoreet id amet.
    </p>
  </div>
</div>
<div class="row-fluid marketing">

  <div class="contextMenu">
            <div class="quickmenu">
                <ul class="nav nav-pills">
                     <li class="dropdown menu-save">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">Download data <span aria-hidden="true" class="icon-data"></span></a>
                        <div class="dropdown-menu dd-export">
                            
                            <ul class="unstyled">
                                <li class="nav-header">
                                    <h3 class="dropdown-subtitle">
                                        Visualization
                                    </h3>
                                </li>
                                <li>
                                    <a href="http://url2png.com/" class="btn block js-export-image" data-track-event="export.png" data-track-value="http://url2png.com/">Save <abbr title="Portable Network Graphics">image</abbr></a>
                                </li>
                                <li class="nav-header">
                                    <h3 class="dropdown-subtitle">
                                        Data
                                    </h3>
                                </li>
                                <li>
                                    <a href="" class="btn block js-export-file">Save as <abbr title="Microsoft Office Excel Spreadsheet">Excel</abbr></a>
                                </li>
                                <li>
                                    <a href="" class="btn block js-export-file" data-track-event="export.csv">Save as <abbr title="Comma-Separated Values">CSV</abbr></a>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </div>

  </div>
    <ul id="tab" class="nav nav-tabs">
      <li class="active">
          <a href="#map" data-toggle="tab">Map</a>
      </li>
      <li class="">
          <a href="#barchart" data-toggle="tab">Stacked Bar Chart</a>
      </li>
   </ul>
<div id="tabContent" class="tab-content">
    <div class="tab-pane fade active in" id="map">
    </div>
    <div class="tab-pane fade" id="barchart">
        
    </div>
</div>
<div class="row-fluid share-bar">
  <ul class="nav nav-pills pull-right">
  <li><p>Share this visualization</p></li>
  <li>
      <a href="https://www.facebook.com/sharer.php"><span aria-hidden="true" class="icon-facebook"></span></a>
  </li>
  <li>
    <a href="https://twitter.com/share"><span aria-hidden="true" class="icon-twitter"></span></a>
  </li>
  <li>
    <a href="https://google.com/plus"><span aria-hidden="true" class="icon-google"></span></a>
  </li>
  <li>
    <a href="https://google.com/plus"><span aria-hidden="true" class="icon-link"></span></a>
  </li>

</ul>


<!-- <li class="nav-header">
    <h3 class="dropdown-subtitle">Link</h3>
  </li> -->

<!-- <input type="text" value="http://www.revenuewatch.org/countries/latin-america/ecuador/overview/"> -->

</div>
</div>


</div> <!-- /container -->
<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.0.min.js"></script>
<script type="text/javascript" src="../assets/js/d3.min.js"></script>
<script type="text/javascript" src="../assets/js/d3.geo.projection.v0.min.js"></script>
<script type="text/javascript" src="../assets/js/topojson.js"></script>
<script type="text/javascript" src="../assets/js/bootstrap-tab.js"></script>
<script type="text/javascript" src="../assets/js/bootstrap-dropdown.js"></script>
<script type="text/javascript" src="../assets/js/stacked.js"></script>
<script type="text/javascript" src="../assets/js/smallStacked.js"></script>
<script type="text/javascript" src="../assets/js/d3tooltip.js"></script>
<script type="text/javascript">

var getTooltip = '<div class="countryTooltip"><a class="close pull-right" href="#">&times;</a><div class="staticInfo"><h2 id="countryName"></h2><div class="countryRank">Rank: <span id="rankingPos"></span> out of 58</div><div id="resourceType">Resource measured: <span id="setTextIcon"></span><span id="setIcon"></span></div><div id="setLink"><a href="">Learn more</a></div><table id="countryData" border="0"><tr><th><p class="field-score">Composite Score </p></th><td><p id="get-score"></p></td></tr><tr><th><p class="field-instituional"> Institutional &Legal Setting </p></th><td><p id="get-instituional"></p></td></tr><tr><th><p class="field-reporting"> Reporting Practices </p></th><td><p id="get-reporting"></p></td></tr><tr><th><p class="field-safeguards"> Safeguards &Quality Controls </p></th><td><p id="get-safeguards"></p></td></tr><tr><th><p class="field-environment"> Enabling Environment </p></th><td><p id="get-environment"></p></td></tr></table></div><div id="smallStacked"></div></div>';

var getTooltipStacked = '<div class="stackedTooltip"><a class="close pull-right" href="#">&times;</a><div class="staticInfo"><h2 id="countryName"></h2><div class="countryRank">Rank: <span id="rankingPos"></span> out of 58</div><div id="resourceType">Resource measured: <span id="setTextIcon"></span><span id="setIcon"></span></div><div id="setLink"><a href="">Learn more</a></div><table id="countryData" border="0"><tr><th><p class="field-score"> Composite Score </p></th><td><p id="get-score"></p></td></tr><tr><th><p class="field-instituional"> Institutional &Legal Setting </p></th><td><p id="get-instituional"></p></td></tr><tr><th><p class="field-reporting"> Reporting Practices </p></th><td><p id="get-reporting"></p></td></tr><tr><th><p class="field-safeguards"> Safeguards &Quality Controls </p></th><td><p id="get-safeguards"></p></td></tr><tr><th><p class="field-environment"> Enabling Environment </p></th><td><p id="get-environment"></p></td></tr></table></div></div>';

var width = 960,
height = 600;

var newProjection = d3.select("#map").append("svg")

.attr("width", width)
.attr("height", height);


var color = d3.scale.threshold()
  .domain([38,46,64,99])
  .range(["#99CF09", "#FEC425", "#FD8B28", "#CF3C09"].reverse());

var projection = d3.geo.robinson()
    .scale(180)
    .translate([width / 2, height / 2]);

// Based the data transformation over the CartoDB
// $ topojson -o world-data-demo.json world-data.geojson --id-property iso3 -p name,pop2005

d3.json("../data/world-data.json", function(error, data) {

d3.json("../data/world-data-demo.json", function(error, world) {

    var path = newProjection.selectAll(".country")
        .data(topojson.object(world, world.objects.countries).geometries)
        .enter().append("path");

        path
          .attr("class", function(d) { return "country " + d.id; })

        .attr("d", d3.geo.path().projection(projection))

        .style("fill", function(d) {
            var country = data.filter(function(country) { return country.iso3 == d.id })[0];    
            if (country) {
                return color(country.rwi_score);

            }
        })
        .tooltip(function(d,i) {
          return {
              cssClass: "RWITooltip",
              type: "mouse",
              pointerEvents:"all",
              displacement: [0,-310],
              content: getTooltip,
              updateContent: function() {
                  var country = data.filter(function(country) { return country.iso3 == d.id })[0];
                      if (country) {
                          var rankOrdinal = country.rwi_rank.toOrdinal();
                          var smallStacked = country.iso3;
                          document.getElementById("countryName").innerHTML = country.name;
                          document.getElementById("rankingPos").innerHTML = rankOrdinal;
                          document.getElementById("setTextIcon").innerHTML = country.resource;
                          document.getElementById("setIcon").innerHTML = " <span aria-hidden='true' class='icon-"+country.resource+"'></span>";
                          document.getElementById("get-score").innerHTML = country.rwi_score;
                          document.getElementById("get-instituional").innerHTML = country.rwi_institutional;
                          document.getElementById("get-reporting").innerHTML = country.rwi_reporting;
                          document.getElementById("get-safeguards").innerHTML = country.rwi_safeguard;
                          document.getElementById("get-environment").innerHTML = country.rwi_enabling;
                          }
                      createSmallStacked(smallStacked);
                      $(".close").click(function(event) {
                        event.preventDefault();
                        $(this).closest(".RWITooltip").remove();
                      })
              },
              show: function() {
                  var country = data.filter(function(country) { return country.iso3 == d.id })[0];
                      if (country) {
                        return country.rwi_score != 0;
                      }
                      
              }
              
          }
        });
    });    
  
});

$(document).ready(function() { 
    $('#tab a').click(function (e) {
      e.preventDefault();
      $(this).tab('show');
    })
    $('.dropdown-toggle').dropdown();
});

Number.prototype.toOrdinal = function() {
  var n = this % 100;
  var suffix = ['th', 'st', 'nd', 'rd', 'th'];
  var ord = n < 21 ? (n < 4 ? suffix[n] : suffix[0]) : (n % 10 > 4 ? suffix[0] : suffix[n % 10]);
  return this + ord;
}




</script>




</body>
</html>